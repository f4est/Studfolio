{% extends 'users/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Настройки резюме" %} | Studfolio{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Боковое меню -->
        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{% trans "Настройки" %}</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'users:profile' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-user me-2"></i>{% trans "Мой профиль" %}
                    </a>
                    <a href="{% url 'users:portfolio_settings' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-palette me-2"></i>{% trans "Настройки портфолио" %}
                    </a>
                    <a href="{% url 'users:resume_settings' %}" class="list-group-item list-group-item-action active">
                        <i class="fas fa-file-alt me-2"></i>{% trans "Настройки резюме" %}
                    </a>
                    <a href="{% url 'users:subscription' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-crown me-2"></i>{% trans "Премиум подписка" %}
                    </a>
                </div>
            </div>
            
            <!-- Предпросмотр и экспорт резюме -->
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">{% trans "Действия" %}</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="/{{ request.LANGUAGE_CODE }}/profile/pdf/?view=true" target="_blank" class="btn btn-outline-primary">
                            <i class="fas fa-eye me-2"></i>{% trans "Предпросмотр резюме" %}
                        </a>
                        <a href="/{{ request.LANGUAGE_CODE }}/profile/pdf/" class="btn btn-primary">
                            <i class="fas fa-file-download me-2"></i>{% trans "Скачать резюме (PDF)" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Основной контент -->
        <div class="col-md-9">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{% trans "Настройки резюме" %}</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Основные настройки -->
                        <div class="mb-4">
                            <h6 class="card-subtitle mb-3 text-muted border-bottom pb-2">
                                {% trans "Выбор шаблона и основные настройки" %}
                            </h6>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label for="{{ settings_form.template.id_for_label }}" class="form-label fw-bold">
                                        {% trans "Шаблон резюме" %}
                                    </label>
                                    {{ settings_form.template }}
                                    {% if settings_form.template.errors %}
                                        <div class="invalid-feedback d-block">
                                            {% for error in settings_form.template.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                    {% if settings_form.template.help_text %}
                                        <div class="form-text">{{ settings_form.template.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Настройки отображаемых разделов -->
                        <div class="mb-4">
                            <h6 class="card-subtitle mb-3 text-muted border-bottom pb-2">
                                {% trans "Настройки отображения" %}
                            </h6>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_profile_image }}
                                        <label class="form-check-label" for="{{ settings_form.show_profile_image.id_for_label }}">
                                            {% trans "Показывать фото профиля" %}
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_contact_info }}
                                        <label class="form-check-label" for="{{ settings_form.show_contact_info.id_for_label }}">
                                            {% trans "Показывать контактную информацию" %}
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_education }}
                                        <label class="form-check-label" for="{{ settings_form.show_education.id_for_label }}">
                                            {% trans "Показывать образование" %}
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_skills }}
                                        <label class="form-check-label" for="{{ settings_form.show_skills.id_for_label }}">
                                            {% trans "Показывать навыки" %}
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_projects }}
                                        <label class="form-check-label" for="{{ settings_form.show_projects.id_for_label }}">
                                            {% trans "Показывать проекты" %}
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_certificates }}
                                        <label class="form-check-label" for="{{ settings_form.show_certificates.id_for_label }}">
                                            {% trans "Показывать сертификаты" %}
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        {{ settings_form.show_achievements }}
                                        <label class="form-check-label" for="{{ settings_form.show_achievements.id_for_label }}">
                                            {% trans "Показывать достижения" %}
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <label for="{{ settings_form.max_projects.id_for_label }}" class="form-label">
                                        {% trans "Макс. проектов:" %}
                                    </label>
                                    {{ settings_form.max_projects }}
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="{{ settings_form.max_certificates.id_for_label }}" class="form-label">
                                        {% trans "Макс. сертификатов:" %}
                                    </label>
                                    {{ settings_form.max_certificates }}
                                </div>
                                
                                <div class="col-md-4">
                                    <label for="{{ settings_form.max_achievements.id_for_label }}" class="form-label">
                                        {% trans "Макс. достижений:" %}
                                    </label>
                                    {{ settings_form.max_achievements }}
                                </div>
                            </div>
                        </div>
                        
                        {% if is_premium and advanced_form %}
                            <!-- Расширенные настройки для премиум пользователей -->
                            <div class="mb-4">
                                <h6 class="card-subtitle mb-3 text-muted border-bottom pb-2">
                                    <i class="fas fa-crown text-warning me-2"></i>{% trans "Расширенные настройки (Премиум)" %}
                                </h6>
                                
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">{% trans "Цветовая схема" %}</label>
                                        <div class="d-flex mb-3">
                                            <div class="me-2">
                                                <label class="form-label small">{% trans "Основной" %}</label>
                                                {{ advanced_form.primary_color }}
                                            </div>
                                            <div class="me-2">
                                                <label class="form-label small">{% trans "Вторичный" %}</label>
                                                {{ advanced_form.secondary_color }}
                                            </div>
                                            <div class="me-2">
                                                <label class="form-label small">{% trans "Акцент" %}</label>
                                                {{ advanced_form.accent_color }}
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex mb-3">
                                            <div class="me-2">
                                                <label class="form-label small">{% trans "Фон" %}</label>
                                                {{ advanced_form.background_color }}
                                            </div>
                                            <div class="me-2">
                                                <label class="form-label small">{% trans "Текст" %}</label>
                                                {{ advanced_form.text_color }}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="{{ advanced_form.font_family.id_for_label }}" class="form-label fw-bold">
                                            {% trans "Шрифт" %}
                                        </label>
                                        {{ advanced_form.font_family }}
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="{{ advanced_form.custom_css.id_for_label }}" class="form-label fw-bold">
                                        {% trans "Пользовательский CSS" %}
                                    </label>
                                    {{ advanced_form.custom_css }}
                                    <div class="form-text">
                                        {% trans "Используйте этот блок для тонкой настройки стилей вашего резюме. Эти стили будут применены поверх стандартных стилей шаблона." %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>{% trans "Сохранить настройки" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Галерея шаблонов резюме -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">{% trans "Доступные шаблоны резюме" %}</h5>
                </div>
                
                <div class="card-body">
                    <!-- Бесплатные шаблоны -->
                    <h6 class="mb-3">{% trans "Бесплатные шаблоны" %}</h6>
                    <div class="row">
                        {% for template in free_templates %}
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 resume-template-card">
                                    <div class="position-relative">
                                        {% if template.preview_image %}
                                            <img src="{{ template.preview_image.url }}" class="card-img-top" alt="{{ template.name }}">
                                        {% else %}
                                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 120px;">
                                                <div class="text-center">
                                                    <i class="fas fa-file-alt fa-3x text-muted mb-2"></i>
                                                    <p class="text-muted">{% trans "Без предпросмотра" %}</p>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        {% if resume_settings.template == template %}
                                            <div class="position-absolute top-0 end-0 p-2">
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle me-1"></i>{% trans "Активен" %}
                                                </span>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="card-body">
                                        <h6 class="card-title">{{ template.name }}</h6>
                                        <p class="card-text small text-muted">{{ template.description|truncatechars:60 }}</p>
                                        
                                        <div class="d-flex justify-content-between">
                                            <span class="badge bg-info">{{ template.get_template_type_display }}</span>
                                            <span class="badge bg-secondary">{{ template.get_color_scheme_display }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Премиум шаблоны -->
                    <h6 class="mb-3 mt-4">
                        <i class="fas fa-crown text-warning me-1"></i>{% trans "Премиум шаблоны" %}
                        {% if not is_premium %}
                            <span class="badge bg-warning text-dark ms-2">
                                <i class="fas fa-lock me-1"></i>{% trans "Требуется подписка" %}
                            </span>
                        {% endif %}
                    </h6>
                    
                    <div class="row">
                        {% for template in premium_templates %}
                            <div class="col-md-4 mb-4">
                                <div class="card h-100 resume-template-card{% if not is_premium %} template-locked{% endif %}">
                                    <div class="position-relative">
                                        {% if template.preview_image %}
                                            <img src="{{ template.preview_image.url }}" class="card-img-top" alt="{{ template.name }}">
                                        {% else %}
                                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 120px;">
                                                <div class="text-center">
                                                    <i class="fas fa-file-alt fa-3x text-muted mb-2"></i>
                                                    <p class="text-muted">{% trans "Без предпросмотра" %}</p>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        {% if not is_premium %}
                                            <div class="position-absolute top-50 start-50 translate-middle">
                                                <i class="fas fa-lock fa-4x text-warning opacity-75"></i>
                                            </div>
                                        {% endif %}
                                        
                                        {% if resume_settings.template == template %}
                                            <div class="position-absolute top-0 end-0 p-2">
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle me-1"></i>{% trans "Активен" %}
                                                </span>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="position-absolute top-0 start-0 p-2">
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-crown me-1"></i>{% trans "Premium" %}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="card-body">
                                        <h6 class="card-title">{{ template.name }}</h6>
                                        <p class="card-text small text-muted">{{ template.description|truncatechars:60 }}</p>
                                        
                                        <div class="d-flex justify-content-between">
                                            <span class="badge bg-info">{{ template.get_template_type_display }}</span>
                                            <span class="badge bg-secondary">{{ template.get_color_scheme_display }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    {% if not is_premium %}
                        <div class="alert alert-warning mt-3">
                            <i class="fas fa-info-circle me-2"></i>
                            {% trans "Для доступа к премиум шаблонам необходима" %}
                            <a href="{% url 'users:subscription' %}" class="alert-link">{% trans "платная подписка" %}</a>.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .template-locked {
        opacity: 0.7;
        filter: grayscale(60%);
    }
    
    .resume-template-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .resume-template-card:hover:not(.template-locked) {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,.1);
    }
</style>
{% endblock %} 